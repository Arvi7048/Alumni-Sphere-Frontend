{"ast":null,"code":"\"use client\";import _objectSpread from\"C:/Users/arvin/OneDrive/Desktop/project2/alumni-verse/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{useState,useEffect,useCallback}from\"react\";import{Link,useNavigate}from\"react-router-dom\";import{MagnifyingGlassIcon,FunnelIcon,MapPinIcon,BuildingOfficeIcon,UserCircleIcon}from\"@heroicons/react/24/outline\";import api from\"../utils/api\";import LoadingSpinner from\"../components/LoadingSpinner\";import{getImageUrl}from\"../utils/image\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Directory=()=>{const[alumni,setAlumni]=useState([]);const[filteredAlumni,setFilteredAlumni]=useState([]);const[loading,setLoading]=useState(true);const[searchTerm,setSearchTerm]=useState(\"\");const[filters,setFilters]=useState({batch:\"\",branch:\"\",location:\"\"});const[showFilters,setShowFilters]=useState(false);const navigate=useNavigate();const fetchAlumni=useCallback(async()=>{try{// Build query parameters for backend filtering\nconst params=new URLSearchParams();if(searchTerm)params.append('search',searchTerm);if(filters.batch)params.append('batch',filters.batch);if(filters.branch)params.append('branch',filters.branch);if(filters.location)params.append('location',filters.location);const queryString=params.toString();const url=queryString?\"/users/directory?\".concat(queryString):\"/users/directory\";const res=await api.get(url);if(res.success){// The API returns { users, totalPages, currentPage, total }\n// We need to extract the users array\nconst users=res.data.users||[];setAlumni(users);setFilteredAlumni(users);// Set filtered results directly from backend\n}else{throw new Error(res.error||'Failed to fetch alumni');}}catch(error){console.error(\"Failed to fetch alumni:\",error);setAlumni([]);// Set empty array on error\nsetFilteredAlumni([]);}finally{setLoading(false);}},[searchTerm,filters]);// Fetch alumni on initial load\nuseEffect(()=>{fetchAlumni();},[fetchAlumni]);// Refetch alumni when search term or filters change (with debouncing)\nuseEffect(()=>{const timeoutId=setTimeout(()=>{fetchAlumni();},300);// 300ms debounce to avoid too many API calls\nreturn()=>clearTimeout(timeoutId);},[searchTerm,filters,fetchAlumni]);// filterAlumni is already defined above with useCallback\nconst handleFilterChange=(key,value)=>{setFilters(prev=>_objectSpread(_objectSpread({},prev),{},{[key]:value}));};const clearFilters=()=>{setFilters({batch:\"\",branch:\"\",location:\"\"});setSearchTerm(\"\");};const branches=[...new Set((alumni||[]).map(person=>person.branch).filter(Boolean))];const batches=[...new Set((alumni||[]).map(person=>person.batch).filter(Boolean))].sort((a,b)=>b-a);if(loading){return/*#__PURE__*/_jsx(LoadingSpinner,{text:\"Loading alumni directory...\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-7xl mx-auto\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-8\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-gray-900 dark:text-gray-100 mb-2\",children:\"Alumni Directory\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-600 dark:text-gray-400\",children:[\"Connect with \",Array.isArray(alumni)?alumni.length:0,\" alumni from our network\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"card p-6 mb-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col lg:flex-row gap-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-1\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(MagnifyingGlassIcon,{className:\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search by name, company, or position...\",value:searchTerm,onChange:e=>setSearchTerm(e.target.value),className:\"input-field pl-10\"})]})}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setShowFilters(!showFilters),className:\"btn-secondary flex items-center\",children:[/*#__PURE__*/_jsx(FunnelIcon,{className:\"h-4 w-4 mr-2\"}),\"Filters\"]})]}),showFilters&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-6 pt-6 border-t border-gray-200 dark:border-gray-700\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\",children:\"Graduation Year\"}),/*#__PURE__*/_jsxs(\"select\",{value:filters.batch,onChange:e=>handleFilterChange(\"batch\",e.target.value),className:\"input-field\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"All years\"}),batches.map(batch=>/*#__PURE__*/_jsx(\"option\",{value:batch,children:batch},batch))]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\",children:\"Branch\"}),/*#__PURE__*/_jsxs(\"select\",{value:filters.branch,onChange:e=>handleFilterChange(\"branch\",e.target.value),className:\"input-field\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"All branches\"}),branches.map(branch=>/*#__PURE__*/_jsx(\"option\",{value:branch,children:branch},branch))]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\",children:\"Location\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Filter by location\",value:filters.location,onChange:e=>handleFilterChange(\"location\",e.target.value),className:\"input-field\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-4 flex justify-end\",children:/*#__PURE__*/_jsx(\"button\",{onClick:clearFilters,className:\"text-sm text-primary-600 hover:text-primary-500 dark:text-primary-400 dark:hover:text-primary-300\",children:\"Clear all filters\"})})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mb-4\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-600 dark:text-gray-400\",children:[\"Showing \",filteredAlumni.length,\" of \",Array.isArray(alumni)?alumni.length:0,\" alumni\"]})}),filteredAlumni.length>0?/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\",children:filteredAlumni.map(person=>/*#__PURE__*/_jsxs(\"div\",{className:\"card p-6 hover:shadow-lg transition-shadow duration-200 flex flex-col h-full\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex-grow\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center mb-4\",children:[person.profileImage?/*#__PURE__*/_jsx(\"img\",{src:getImageUrl(person.profileImage),alt:person.name,className:\"w-16 h-16 rounded-full object-cover\",onError:e=>{e.target.onerror=null;e.target.src=\"/placeholder.svg\";},crossOrigin:\"anonymous\"}):/*#__PURE__*/_jsx(\"div\",{className:\"w-16 h-16 rounded-full bg-gray-300 dark:bg-gray-600 flex items-center justify-center\",children:/*#__PURE__*/_jsx(UserCircleIcon,{className:\"w-10 h-10 text-gray-500 dark:text-gray-400\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"ml-4\",children:[/*#__PURE__*/_jsx(Link,{to:\"/profile/\".concat(person._id),className:\"text-lg font-semibold text-gray-900 dark:text-gray-100 hover:underline\",children:person.name}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600 dark:text-gray-400\",children:[person.batch,\" \\u2022 \",person.branch]})]})]}),person.company&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center mb-2\",children:[/*#__PURE__*/_jsx(BuildingOfficeIcon,{className:\"h-4 w-4 text-gray-400 mr-2\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm text-gray-600 dark:text-gray-400\",children:[person.position,\" at \",person.company]})]}),person.location&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center mb-4\",children:[/*#__PURE__*/_jsx(MapPinIcon,{className:\"h-4 w-4 text-gray-400 mr-2\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-600 dark:text-gray-400\",children:person.location})]}),person.bio&&/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600 dark:text-gray-400 mb-4 line-clamp-3\",children:person.bio})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-auto pt-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-2\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>navigate('/chat',{state:{user:person._id}}),className:\"flex-1 btn-primary text-center text-sm py-2\",children:\"Message\"}),person.linkedin&&/*#__PURE__*/_jsx(\"a\",{href:person.linkedin,target:\"_blank\",rel:\"noopener noreferrer\",className:\"btn-secondary text-sm py-2 px-4\",children:\"LinkedIn\"})]})})]},person._id))}):/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-12\",children:[/*#__PURE__*/_jsx(UserCircleIcon,{className:\"mx-auto h-12 w-12 text-gray-400\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"mt-2 text-sm font-medium text-gray-900 dark:text-gray-100\",children:\"No alumni found\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-gray-500 dark:text-gray-400\",children:\"Try adjusting your search or filter criteria.\"})]})]});};export default Directory;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}