{"ast":null,"code":"\"use client\";import _objectSpread from\"C:/Users/arvin/OneDrive/Desktop/project2/alumni-verse/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{useState,useEffect,useCallback}from\"react\";import{useAuth}from\"../context/AuthContext\";import{PlusIcon,MagnifyingGlassIcon,MapPinIcon,BuildingOfficeIcon,CalendarDaysIcon,BriefcaseIcon}from\"@heroicons/react/24/outline\";import api from\"../utils/api\";import Modal from\"../components/Modal\";import LoadingSpinner from\"../components/LoadingSpinner\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const Jobs=()=>{const{user}=useAuth();const[jobs,setJobs]=useState([]);const[filteredJobs,setFilteredJobs]=useState([]);const[loading,setLoading]=useState(true);const[searchTerm,setSearchTerm]=useState(\"\");const[aiSearching,setAISearching]=useState(false);const[aiError,setAIError]=useState(\"\");const[showPostModal,setShowPostModal]=useState(false);const[filters]=useState({jobType:'all',location:'',salary:''});const[posting,setPosting]=useState(false);const[applying,setApplying]=useState(null);const[jobForm,setJobForm]=useState({title:\"\",company:\"\",location:\"\",type:\"Full-time\",description:\"\",requirements:\"\",salary:\"\",applicationUrl:\"\",applicationEmail:\"\"});// âœ… Keep this only version of filterJobs\nconst filterJobs=useCallback(()=>{let filtered=jobs;if(searchTerm){const term=searchTerm.toLowerCase();filtered=filtered.filter(job=>job.title.toLowerCase().includes(term)||job.company.toLowerCase().includes(term)||job.description.toLowerCase().includes(term)||job.requirements.toLowerCase().includes(term)||job.location.toLowerCase().includes(term));}if(filters.jobType&&filters.jobType!=='all'){filtered=filtered.filter(job=>job.jobType===filters.jobType);}if(filters.location){filtered=filtered.filter(job=>job.location.toLowerCase().includes(filters.location.toLowerCase()));}if(filters.salary){filtered=filtered.filter(job=>{if(!job.salary)return false;return job.salary>=filters.salary;});}setFilteredJobs(filtered);},[jobs,searchTerm,filters]);useEffect(()=>{fetchJobs();},[]);useEffect(()=>{filterJobs();},[filterJobs]);useEffect(()=>{if(!searchTerm){setFilteredJobs(jobs);setAIError(\"\");return;}let cancelled=false;async function aiSearch(){setAISearching(true);setAIError(\"\");try{const res=await api.post(\"/ai/search\",{query:searchTerm,entity:\"jobs\"});if(!res.success)throw new Error(res.error||'AI search failed');if(!cancelled)setFilteredJobs(res.data.results||[]);}catch(err){setAIError(\"AI search failed, showing keyword results.\");filterJobs();}finally{setAISearching(false);}}aiSearch();return()=>{cancelled=true;};},[searchTerm,jobs,filterJobs]);const fetchJobs=async()=>{try{const res=await api.get(\"/jobs\");if(res.success){setJobs(res.data.jobs||[]);}else{throw new Error(res.error||'Failed to fetch jobs');}}catch(error){console.error(\"Failed to fetch jobs:\",error);}finally{setLoading(false);}};const handleJobFormChange=e=>{setJobForm(_objectSpread(_objectSpread({},jobForm),{},{[e.target.name]:e.target.value}));};const handlePostJob=async e=>{e.preventDefault();setPosting(true);try{const res=await api.post(\"/jobs\",jobForm);if(!res.success)throw new Error(res.error||'Failed to post job');setJobs([res.data,...jobs]);setShowPostModal(false);setJobForm({title:\"\",company:\"\",location:\"\",type:\"Full-time\",description:\"\",requirements:\"\",salary:\"\",applicationUrl:\"\",applicationEmail:\"\"});}catch(error){console.error(\"Failed to post job:\",error);}finally{setPosting(false);}};const handleDeleteJob=async jobId=>{if(typeof window==='undefined'||!window.confirm('Are you sure you want to delete this job?'))return;try{const res=await api.delete(\"/jobs/\".concat(jobId));if(!res.success)throw new Error(res.error||'Failed to delete job');setJobs(jobs.filter(j=>j._id!==jobId));}catch(error){alert('Failed to delete job.');}};const handleApply=async jobId=>{setApplying(jobId);try{const res=await api.post(\"/jobs/\".concat(jobId,\"/apply\"));if(!res.success)throw new Error(res.error||'Failed to apply for job');setJobs(jobs.map(job=>job._id===jobId?_objectSpread(_objectSpread({},job),{},{applicants:[...job.applicants,user._id]}):job));}catch(error){console.error(\"Failed to apply for job:\",error);}finally{setApplying(null);}};const hasApplied=job=>{return job.applicants.includes(user._id);};const isJobPoster=job=>{return job.postedBy&&job.postedBy._id&&user&&user._id&&job.postedBy._id===user._id;};if(loading){return/*#__PURE__*/_jsx(LoadingSpinner,{text:\"Loading job listings...\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-7xl mx-auto\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mb-8\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-gray-900 dark:text-gray-100 mb-2\",children:\"Job Board\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 dark:text-gray-400\",children:\"Discover career opportunities shared by alumni\"})]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setShowPostModal(true),className:\"btn-primary flex items-center\",children:[/*#__PURE__*/_jsx(PlusIcon,{className:\"h-4 w-4 mr-2\"}),\"Post Job\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"card p-6 mb-8\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(MagnifyingGlassIcon,{className:\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search jobs by title, company, or location...\",value:searchTerm,onChange:e=>setSearchTerm(e.target.value),className:\"input-field pl-10\"}),aiSearching&&/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-500 mt-2\",children:\"AI searching...\"}),aiError&&/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-red-500 mt-2\",children:aiError})]})}),filteredJobs.length>0?/*#__PURE__*/_jsx(\"div\",{className:\"space-y-6\",children:filteredJobs.map(job=>{var _job$postedBy,_job$applicants,_job$applicants2;return/*#__PURE__*/_jsxs(\"div\",{className:\"card p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-start mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2\",children:job.title}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap items-center gap-4 text-sm text-gray-600 dark:text-gray-400 mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(BuildingOfficeIcon,{className:\"h-4 w-4 mr-1\"}),job.company]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(MapPinIcon,{className:\"h-4 w-4 mr-1\"}),job.location]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(BriefcaseIcon,{className:\"h-4 w-4 mr-1\"}),job.type]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(CalendarDaysIcon,{className:\"h-4 w-4 mr-1\"}),new Date(job.createdAt).toLocaleDateString()]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[user.role==='admin'&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleDeleteJob(job._id),className:\"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded-full text-sm font-medium mr-2\",children:\"Delete\"}),job.salary&&/*#__PURE__*/_jsxs(\"span\",{className:\"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 px-3 py-1 rounded-full text-sm font-medium\",children:[\"\\u20B9 \",String(job.salary).replace(/[^0-9.,-]/g,'')]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium text-gray-900 dark:text-gray-100 mb-2\",children:\"Job Description\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 dark:text-gray-400 whitespace-pre-wrap\",children:job.description})]}),job.requirements&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium text-gray-900 dark:text-gray-100 mb-2\",children:\"Requirements\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 dark:text-gray-400 whitespace-pre-wrap\",children:job.requirements})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between pt-4 border-t border-gray-200 dark:border-gray-700\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-500 dark:text-gray-400\",children:[\"Posted by \",((_job$postedBy=job.postedBy)===null||_job$postedBy===void 0?void 0:_job$postedBy.name)||'Unknown User',\" \\u2022 \",((_job$applicants=job.applicants)===null||_job$applicants===void 0?void 0:_job$applicants.length)||0,\" applicant\",((_job$applicants2=job.applicants)===null||_job$applicants2===void 0?void 0:_job$applicants2.length)!==1?\"s\":\"\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-2\",children:[!isJobPoster(job)&&/*#__PURE__*/_jsx(_Fragment,{children:hasApplied(job)?/*#__PURE__*/_jsx(\"span\",{className:\"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 px-4 py-2 rounded-lg text-sm font-medium\",children:\"Applied\"}):/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleApply(job._id),disabled:applying===job._id,className:\"btn-primary disabled:opacity-50 disabled:cursor-not-allowed flex items-center\",children:applying===job._id?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"spinner mr-2\"}),\"Applying...\"]}):\"Apply Now\"})}),(job.applicationUrl||job.applicationEmail)&&/*#__PURE__*/_jsx(\"a\",{href:job.applicationUrl||\"mailto:\".concat(job.applicationEmail),target:\"_blank\",rel:\"noopener noreferrer\",className:\"btn-secondary\",children:\"External Apply\"})]})]})]},job._id);})}):/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-12\",children:[/*#__PURE__*/_jsx(BriefcaseIcon,{className:\"mx-auto h-12 w-12 text-gray-400\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"mt-2 text-sm font-medium text-gray-900 dark:text-gray-100\",children:\"No jobs found\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-gray-500 dark:text-gray-400\",children:searchTerm?\"Try adjusting your search criteria.\":\"Be the first to post a job opportunity!\"})]}),/*#__PURE__*/_jsx(Modal,{isOpen:showPostModal,onClose:()=>setShowPostModal(false),title:\"Post a Job\",size:\"lg\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handlePostJob,className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\",children:\"Job Title *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"title\",required:true,value:jobForm.title,onChange:handleJobFormChange,className:\"input-field\",placeholder:\"e.g. Senior Software Engineer\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\",children:\"Company *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"company\",required:true,value:jobForm.company,onChange:handleJobFormChange,className:\"input-field\",placeholder:\"Company name\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\",children:\"Location *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"location\",required:true,value:jobForm.location,onChange:handleJobFormChange,className:\"input-field\",placeholder:\"e.g. San Francisco, CA or Remote\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\",children:\"Job Type *\"}),/*#__PURE__*/_jsxs(\"select\",{name:\"type\",required:true,value:jobForm.type,onChange:handleJobFormChange,className:\"input-field\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"Full-time\",children:\"Full-time\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Part-time\",children:\"Part-time\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Contract\",children:\"Contract\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Internship\",children:\"Internship\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Remote\",children:\"Remote\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\",children:\"Salary Range\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"salary\",value:jobForm.salary,onChange:handleJobFormChange,className:\"input-field\",placeholder:\"e.g. \\u20B980,000 - \\u20B9120,000\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\",children:\"Job Description *\"}),/*#__PURE__*/_jsx(\"textarea\",{name:\"description\",required:true,rows:4,value:jobForm.description,onChange:handleJobFormChange,className:\"input-field\",placeholder:\"Describe the role, responsibilities, and what you're looking for...\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\",children:\"Requirements\"}),/*#__PURE__*/_jsx(\"textarea\",{name:\"requirements\",rows:3,value:jobForm.requirements,onChange:handleJobFormChange,className:\"input-field\",placeholder:\"List the required skills, experience, and qualifications...\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\",children:\"Application URL\"}),/*#__PURE__*/_jsx(\"input\",{type:\"url\",name:\"applicationUrl\",value:jobForm.applicationUrl,onChange:handleJobFormChange,className:\"input-field\",placeholder:\"https://company.com/careers/apply\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\",children:\"Application Email\"}),/*#__PURE__*/_jsx(\"input\",{type:\"email\",name:\"applicationEmail\",value:jobForm.applicationEmail,onChange:handleJobFormChange,className:\"input-field\",placeholder:\"careers@company.com\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end space-x-4 pt-4\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setShowPostModal(false),className:\"btn-secondary\",children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:posting,className:\"btn-primary disabled:opacity-50 disabled:cursor-not-allowed flex items-center\",children:posting?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"spinner mr-2\"}),\"Posting...\"]}):\"Post Job\"})]})]})})]})// No need to change your return() unless you want enhancements.\n;};export default Jobs;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}